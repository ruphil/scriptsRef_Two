<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
  </head>
  <body>
    <h3>UPLOAD Zip FLIGHTIDS_KMLS_SHAPEFILES</h3>
    <p>Select Zip File generated by KML Tool</p>
    <input type="file" id="uploadfile"/><br/><br/>
    <button id="uploadBtn">Upload File</button>
    <p id='status'></p>

    <script>
      let fileInput = document.getElementById('uploadfile');
      let statusP = document.getElementById('status');
      let uploadBtn = document.getElementById('uploadBtn');

      fileInput.onchange = function () {
        statusP.innerText = '';
      }

      uploadBtn.onclick = function () {
        console.log(fileInput.files.length);

        if(fileInput.files.length == 0){
          statusP.innerText = 'Kindly Select the Zip File For Todays Each Flight Separately';
        } else {
          let re = /(?:\.([^.]+))?$/;

          let filename = fileInput.files[0].name;
          let fileextension = re.exec(filename)[1]
          console.log(filename, fileextension);

          if(fileextension != 'zip'){
            statusP.innerText = 'Kindly Select the Zip File For Todays Each Flight Separately';
          } else {
            statusP.innerText = 'Please Wait... File is Uploading...'
            startUploading();
          }
        }
      }

      function startUploading(){
        let file = fileInput.files[0];

        const fileReader = new FileReader();
        fileReader.onload = function(e){
            let data = e.target.result.split(",");

            let obj = { fileName: file.name, data: data[1] };
            google.script.run.withSuccessHandler(handleResponse).uploadFile(obj);
        };

        fileReader.readAsDataURL(file);
      }

      function handleResponse(id){
        statusP.innerText = 'File Successfully Uploaded and Saved with Id: ' + id;
      }

    </script>
  </body>
</html>
